<html>
<head>
		<title>Sign In</title>
			<link rel="stylesheet" href="styles.css">
			<meta http-equiv="Content-Type" content="text/html, charset=UTF-8" />
			</head>
		<body>
<div class="topnav">
<a class="active" href="./">Home</a> 
<a>Connect</a>
</div>
</br>

		<form method="post" action="signin.php">
		<input type="text" name="pseudo" placeholder="username" value="" />
		<input type="password" name="passwd" placeholder="password" value="" />
		<input type="submit" name="submit" value="Se connecter" />
		</form>


<?php
$dsn = "mysql:host=localhost;dbname=scrowdb"; 
$username = "root";
$password = "toor";

try {
	$pdo = new PDO($dsn, $username, $password);
} catch (PDOException $e) {
	print "Error connection failed : ". $e->getMessage() . "<br/>";
	die();
}

#Sign in
if(isset($_POST['pseudo']) && isset($_POST['passwd'])) {
	$pseudo = $_POST["pseudo"];
	$req = "SELECT passwd from users where pseudo='".$pseudo."'";
	$passbase = $pdo->query($req)->fetch();
	$passbase = $passbase[0];
	#var_dump($passbase);
	$passEntered = $_POST["passwd"];
	if ($passEntered == $passbase) {
		echo "success";
		setCookie("user", $pseudo);
		header("Location: profile.php?pseudo=".$pseudo);
	}
	else {
		// Login failed
		echo 'Authentication failed <br> Username and/or password incorrect';
	}	

} 

?>

</body>
</html>	
